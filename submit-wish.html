<!DOCTYPE html>
<html>
<head>
  <title>WishWell - Submit Wish</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
   

  <h2>🎁 Submit a Wish on Behalf of Someone</h2>

  <nav style="background-color: #4CAF50; padding: 10px;">
    <a href="index.html" style="color: white; margin-right: 20px; text-decoration: none;">🏠 Home</a>
    <a href="submit-wish.html" style="color: white; margin-right: 20px; text-decoration: none;">🎁 Submit Wish</a>
    <a href="wishes.html" style="color: white; margin-right: 20px; text-decoration: none;">👀 View Wishes</a>
    <a href="login.html" style="color: white; text-decoration: none;">🚪 Logout</a>
    <a href="how-it-works.html" style="color: white; margin-left: 20px;">❓ How It Works</a>
  </nav>

  <form id="wishForm">
    <!-- Beneficiary details -->
    <input type="text" id="beneficiaryName" placeholder="Beneficiary's Name" required><br><br>
    <input type="number" id="beneficiaryAge" placeholder="Age" required><br><br>
    <input type="text" id="location" placeholder="Location (Area/City)" required><br><br>
    <textarea id="wishText" placeholder="Describe the wish in detail" required></textarea><br><br>

    <!-- Deadline input -->
    <label for="deadline">⏰ Deadline to Fulfill Wish:</label><br>
    <input type="date" id="deadline" required><br><br>

    <!-- Volunteer details -->
    <input type="text" id="volunteerName" placeholder="Your (Volunteer) Name" required><br><br>
    <input type="text" id="volunteerContact" placeholder="Your Contact (optional)"><br><br>

    <button type="submit">Submit Wish</button>
  </form>

  <p id="message"></p>

  <script type="module">
    import { auth, db } from './firebase/firebase-config.js';
    import { addDoc, collection, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    const form = document.getElementById('wishForm');
    const message = document.getElementById('message');
    let userId = null;

    // Check if user is logged in
    onAuthStateChanged(auth, (user) => {
      if (user) {
        userId = user.uid;
      } else {
        window.location.href = "login.html"; // Redirect to login
      }
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const wishData = {
        beneficiaryName: document.getElementById('beneficiaryName').value,
        beneficiaryAge: document.getElementById('beneficiaryAge').value,
        location: document.getElementById('location').value,
        wish: document.getElementById('wishText').value,
        volunteerName: document.getElementById('volunteerName').value,
        volunteerContact: document.getElementById('volunteerContact').value,
        deadline: document.getElementById('deadline').value, // ✅ Deadline added
        fulfilled: false,
        userId,
        timestamp: serverTimestamp()
      };

      try {
        await addDoc(collection(db, "wishes"), wishData);
        message.innerText = "✅ Wish submitted successfully!";
        form.reset();
      } catch (error) {
        message.innerText = "❌ Error: " + error.message;
      }
    });
  </script>
  <script type="module">
  async function loadLanguage(lang) {
    const res = await fetch(`lang/${lang}.json`);
    const translations = await res.json();

    document.querySelectorAll("[data-i18n]").forEach(el => {
      const key = el.getAttribute("data-i18n");
      if (translations[key]) {
        el.innerText = translations[key];
      }
    });
  }

  const languageSwitcher = document.getElementById("languageSwitcher");
  languageSwitcher.addEventListener("change", (e) => {
    localStorage.setItem("lang", e.target.value);
    loadLanguage(e.target.value);
  });

  const selectedLang = localStorage.getItem("lang") || "en";
  languageSwitcher.value = selectedLang;
  loadLanguage(selectedLang);
</script>

</body>
</html>
